/*! gamegraph 2017-01-25 */
jQuery(document).ready(function(a){function b(a){var b=~~(a/60),c=("00"+~~(a%60)).substr(-2);return b+":"+c}function c(a){return a>0?"home":a<0?"away":0==a?"neutral":void 0}function d(a,b){var b="undefined"!=typeof b?b:w;return a.filter(function(a){var c=a.time;return a.scoreChange&&c<=b})}function e(a,b){var c=0;return a.forEach(function(a,d){return a.time>b?c:void(c=d)}),c}function f(a){var b=a.text;return null!==a.name&&(b=a.name),"timeout"===a.category&&(b="Auszeit"),b}function g(a){var b="";return 1===a.scoreChange&&(b="Tor zum  "+a.scoreHome+":"+a.scoreAway,a.seven&&(b+=" (7m)")),"yellow"===a.category&&(b="Gelbe Karte"),"red"===a.category&&(b="Rote Karte"),"suspension"===a.category&&(b="2-min-Strafe"),0===a.text.indexOf("Spiel")&&(b=""),"timeout"===a.category&&(b=a.text.replace("Auszeit ","")),b}function h(a){if(null!==a){var b=a;return b=b.trim(),b=b.replace("Ä","Ae"),b=b.replace("ä","ae"),b=b.replace("Ö","Oe"),b=b.replace("ö","oe"),b=b.replace("Ü","Ue"),b=b.replace("ü","ue"),b=b.replace("ß","ss"),b=b.replace(" ","-"),b=b.toLowerCase()}return""}function j(a,b){for(var c=-1,d=15,e=["gelb","zweiMin1","zweiMin2","zweiMin3","rot"],f=0;f<=b;f++)null!=a[e[f]]&&c++;return c*d}function k(a,b){var c;return c=picarray.findIndex(function(b){return b===a}),"-1"==c&&(c=picarray.findIndex(function(a){return"dummy"===a})),c}function l(a){if(null!==a){for(var b=0,c=a.length-1;c>=0;c--)Math.abs(a[c].scoreDiff)>b&&(b=Math.abs(a[c].scoreDiff));return b}return 0}function m(a,b){fa.attr("d",ga(d(a,b))),aa.append("g").attr("id","goaldots").selectAll(".point").data(d(a,b)).enter().append("svg:circle").attr("class",function(a){return a.alias}).classed("goaldot",!0).attr("cx",function(a){return ba(a.scoreDiff)}).attr("cy",function(a){return ca(a.time)}).attr("r",3).on("mouseover",function(a){q(a.actionIndex)}).on("mouseout",function(a){o()}),ha(a)}function n(a,b){if(fa.attr("d",ga(d(a,b))),aa.selectAll(".goaldot").classed("showGoal",function(a){return a.time>b}),b<3600){var c=e(a,b);q(a[c].actionIndex)}}function o(){aa.selectAll(".actionTagItem").classed("hideactiontag",!0)}function p(a){var b=55,c=80,d=10,e=200,f=_.append("g").attr("id","gameInfo").attr("transform","translate(30,30)");f.append("text").text(a.datum+" | "+a.zeit+" Uhr").attr("transform","translate("+e+",10)"),f.append("text").text(a.hallenName+" "+a.stadt).attr("transform","translate("+e+",30)"),f.append("text").text(a.heim).attr("class","teams home").attr("transform","translate("+(e-d)+","+b+")"),f.append("text").text("-").attr("class","teams center").attr("transform","translate("+e+","+b+")"),f.append("text").text(a.gast).attr("class","teams away").attr("transform","translate("+(e+d)+","+b+")"),f.append("text").text(a.toreHeim).attr("class","result home").attr("transform","translate("+(e-d)+","+c+")"),f.append("text").text(":").attr("class","result center").attr("transform","translate("+e+","+c+")"),f.append("text").text(a.toreGast).attr("class","result away").attr("transform","translate("+(e+d)+","+c+")")}function q(a){o();var b;b="string"==typeof a?a:"event-"+a,aa.selectAll("."+b).classed("hideactiontag",!1)}function r(a){ia.select("#scoreHome").text(a.scoreHome),ia.select("#scoreAway").text(a.scoreAway),ia.select("#scoreTime").text(a.timeString.replace(":"," "))}var s,t={top:170,right:100,bottom:50,left:500},u=800,v=0,w=3600;s=u-t.left-t.right;var x,y=900;x=y-t.top-t.bottom;var z=3600,A=10,B=50,C=x,D=v,E=w,F=z,G=s+t.left+10,H=t.top,I=20,J="m 13.115534,9.9881529 1.57002,1.3488911 M 2.884465,6.924534 1.3144455,5.5756426 m 6.6710961,1.5572762 0,2.6626503 M 11.092465,14.955035 9.3489573,13.72121 10.408369,11.342436 m 2.707966,-1.33957 -2.717871,1.335272 L 7.9999995,9.7885418 5.6015341,11.338138 2.8836636,10.002866 c -0.031955,-1.0322124 -0.077459,-2.0608889 0,-3.0930452 L 5.6015341,5.5745493 7.9999995,7.1241448 10.398464,5.5745493 13.116335,6.9098208 c 0.0671,1.0315972 0.03074,2.0613406 0,3.0930452 z M 2.8844639,9.9881529 1.3144444,11.337044 M 4.9075332,14.955035 6.6510408,13.72121 5.591629,11.342436 m 1.0523066,2.341088 c 0.9040461,-0.0071 1.80808,-0.0032 2.7121269,0 m 3.7594715,-6.75899 1.57002,-1.3488914 M 11.092465,1.9576518 9.3489573,3.1914774 10.408369,5.570251 M 4.9075332,1.9576518 6.6510408,3.1914774 5.591629,5.570251 M 6.6439356,3.2291631 c 0.9040472,0.00616 1.808079,0.0028 2.7121269,0",K="m 1.5479708,2.0469633 c -0.0055,-0.3481 0.09473,-0.99431 0.757778,-1.08197996 0.663049,-0.0877 0.984979,0.41393996 1.023309,0.83681996 0.145432,1.6045 0.340924,3.35834 0.521594,5.3018 0.197975,-1.82049 0.271689,-3.59258 0.565139,-5.3573 0.05933,-0.35675 0.344945,-0.79349996 0.86522,-0.76732996 0.422562,0.0213 0.853325,0.47233996 0.837769,0.90341996 -0.07695,2.1324 -0.23198,4.58337 -0.267896,5.89491 0.02371,-0.7087 0.700297,-1.20414 1.250499,-1.08488 0.843158,0.18277 0.654307,1.0968 0.537517,1.70741 0.253651,-0.38414 0.722906,-0.78948 1.382941,-0.45856 0.660035,0.33092 0.416408,1.87304 0.427984,2.2358497 0.04906,1.53732 0.02933,0.97655 -0.152256,2.65827 -0.112823,1.04489 -0.764038,2.08284 -0.941425,3.09682 l -6.026729,0.02413 c -0.167857,6.7e-4 -1.239828,-2.40645 -1.75789398,-3.57345 -0.389664,-0.87776 1.23538198,-3.8101997 1.23538198,-3.8101997 0,0 -0.221374,-4.16231 -0.258932,-6.52573 z",L="index.php?option=com_hbteam&task=getGameChartData&format=raw" + "&teamkey=" + teamkey + "&season=" + season + "&gameId=" + gameId,M='../../../images/handball/'+teamkey+'_playersprites.png',N=100,O=150,P=20,Q=88,R=37,S=53,T=135,U=8,V=2,W=22,X={left:30,top:t.top};Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(a){"use strict";if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var b,c=Object(this),d=c.length>>>0,e=arguments[1],f=0;f<d;f++)if(b=c[f],a.call(e,b,f,c))return f;return-1},enumerable:!1,configurable:!1,writable:!1}),document.getElementsByClassName||(document.getElementsByClassName=function(a){var b,c,d,e=document,f=[];if(e.querySelectorAll)return e.querySelectorAll("."+a);if(e.evaluate)for(c=".//*[contains(concat(' ', @class, ' '), ' "+a+" ')]",b=e.evaluate(c,e,null,0,null);d=b.iterateNext();)f.push(d);else for(b=e.getElementsByTagName("*"),c=new RegExp("(^|\\s)"+a+"(\\s|$)"),d=0;d<b.length;d++)c.test(b[d].className)&&f.push(b[d]);return f}),void 0===SVGElement.prototype.getElementsByClassName&&(SVGElement.prototype.getElementsByClassName=function(a){return this.querySelectorAll("."+a)});var Y=new Image;Y.src=M;var Z=d3.scale.linear().domain([D,E]).range([0,C]).clamp(!0),$=d3.svg.brush().y(Z).extent([F,F]);d3.json(L,function(a,c){if(null!=a&&console.log(a),"undefined"!=typeof c||null!==c.playerdata){gameinfo=c.gameinfo,p(gameinfo),gamedata=c.gamedata,playerdata=c.playerdata,picarray=c.picarray,A=l(gamedata)+1,ba.domain([-A,A]).range([0,s]),da.orient("top").tickValues(function(){for(var a=[],b=0,c=-A;c<=A;c++)A>10&&c%2==0&&(a[b++]=c);return a}).tickFormat(function(a){return Math.abs(a)}).tickSize(5).scale(ba),aa.select(".axis.xaxis").call(da),aa.select(".grid").call(da.tickSize(-x,0,0).tickFormat("")),m(gamedata,z);var d=function(){var a=$.extent()[0];d3.event.sourceEvent&&(a=Z.invert(d3.mouse(this)[1]),$.extent([a,a])),n(gamedata,~~a);var b=e(gamedata,~~a);r(gamedata[b]),h.attr("transform","translate(0,"+Z(a)+")"),h.select("text").text(~~a)};$.on("brush",d);var f=_.append("g").attr("class","sliderbox").attr("transform","translate("+G+","+H+")");f.append("g").attr("class","y axis").attr("transform","translate("+B/2+",0)").call(d3.svg.axis().scale(Z).orient("left").tickSize(0).tickPadding(12).tickValues([Z.domain()[0],Z.domain()[1]]).tickFormat(function(a){return b(a)})).select(".domain").select(function(){return this.parentNode.appendChild(this.cloneNode(!0))}).attr("class","halo");var g=f.append("g").attr("class","slider").call($);g.selectAll(".extent,.resize").remove(),g.select(".background").attr("transform","translate(0,0)").style("cursor","pointer").attr("width",B);var h=g.append("g").attr("class","handle");h.append("path").attr("transform","translate("+B/2+",0)").attr("d","M "+-I+" 0 H "+I),h.append("text").text(F).attr("transform","translate("+B+",6)"),g.call($.event);var i=ja.selectAll(".test").data(playerdata).enter().append("g").attr("id",function(a){return"profile-"+a.alias}).attr("class","pic").attr("transform",function(a,b){return"translate(0,"+b*(2.3*W)+")"}).on("mouseover",function(a){q(a.alias)}).on("mouseout",function(a){o()});i.append("defs").append("pattern").attr("id",function(a,b){return"profilepic-"+b}).attr("height",1).attr("width",1).attr("x","0").attr("y","0").append("image").attr("x",function(a,b){return-k(a.alias)*(2*W)}).attr("y",0).attr("width",2*W*picarray.length).attr("height",2*W).attr("xlink:href",M),i.append("circle").attr("r",W).attr("cx",W+40).attr("cy",W).attr("fill",function(a,b){return"url(#profilepic-"+b+")"}),i.append("text").attr("class","action number bg").attr("x",50).attr("y",40).text(function(a){return a.trikotNr}),i.append("text").attr("class","action number fg").attr("x",52).attr("y",42).text(function(a){return a.trikotNr}),i.append("text").attr("class","profile name").attr("x",2.5*W+40).attr("y",12).text(function(a){return a.name});var t=i.append("g").attr("class","icons").attr("transform",function(a){var b=0;return b=2.5*W+45,"translate("+b+",20)"}).style("opacity",.8),u=i.append("g").attr("class","icons").attr("transform",function(a){var b=0,c=document.getElementById("profile-"+a.alias).getElementsByClassName("name")[0].getBBox();b=2.5*W+40+c.width+10;var d=-2;return"translate("+b+","+d+")"}).style("opacity",.8);u.filter(function(a){return null!=a.gelb}).append("rect").attr("class","card yellowcard").attr("width",10).attr("height",15).attr("x",function(a){return j(a,0)}).attr("y",.5).attr("rx",2).attr("ry",2),u.filter(function(a){return null!=a.rot}).append("rect").attr("class","card redcard").attr("width",10).attr("height",15).attr("x",function(a){return j(a,4)}).attr("y",.5).attr("rx",2).attr("ry",2);var v=t.filter(function(a){return null!==a.tore}).append("g").attr("class","ball").attr("transform","translate(0,0), scale(0.7)");v.each(function(a){for(var b=d3.select(this),c=b.data()[0].tore,d=0;d<c;d++){var e=b.append("g").attr("class","goal-"+d).attr("transform","translate( "+18*d+",0 )");e.append("circle").attr("class","goal-"+d).attr("cx",8).attr("cy",8.45).attr("r",7.5),e.append("path").attr("d",J)}}),u.filter(function(a){return null!=a.zweiMin1}).append("path").attr("class","suspension bench1").attr("transform",function(a){return"translate("+j(a,1)+",0)"}).attr("d",K),u.filter(function(a){return null!=a.zweiMin2}).append("path").attr("class","suspension bench2").attr("transform",function(a){return"translate("+j(a,2)+",0)"}).attr("d",K),u.filter(function(a){return null!=a.zweiMin3}).append("path").attr("class","suspension bench3").attr("transform",function(a){return"translate("+j(a,3)+",0)"}).attr("d",K)}else console.log("No data")});var _=d3.select("#gamegraph").append("svg:svg").attr("width",u).attr("height",y),aa=_.append("g").attr("transform","translate("+t.left+","+t.top+")"),ba=d3.scale.linear().domain([-A,A]).range([0,s]),ca=d3.scale.linear().domain([v,w]).range([0,x]),da=d3.svg.axis().orient("top").tickValues(function(){for(var a=[],b=0,c=-A;c<=A;c++)a[b++]=c;return a}).tickFormat(function(a){return Math.abs(a)}).tickSize(5).scale(ba),ea=d3.svg.axis().orient("left").tickValues(function(){var a=new Array;for(i=0;i<13;i++)a[i]=300*i;return a}).tickFormat(function(a){return b(a)}).scale(ca);aa.append("g").attr("class","axis yaxis").call(ea),aa.append("g").attr("class","axis xaxis").call(da),aa.append("g").attr("class","grid").call(da.tickSize(-x,0,0).tickFormat("")),aa.append("g").attr("class","grid").call(ea.tickSize(-s,0,0).tickFormat(""));var fa=aa.append("path").attr("id","scoreline").attr("class","line"),ga=d3.svg.line().x(function(a){return ba(parseInt(a.scoreDiff))}).y(function(a){return ca(a.time)});aa.append("path").attr("class","center-line").attr("d",ga([{time:0,scoreDiff:0},{time:w,scoreDiff:0}])),aa.append("path").attr("class","halftime-line").attr("d",ga([{time:w/2,scoreDiff:-A},{time:w/2,scoreDiff:A}]));var ha=function(a){var b=aa.append("g").attr("id","allactiontags").selectAll(".actiontagtest").data(a).enter().append("g").attr("transform",function(a){return"translate(-195,"+ca(a.time)+")"}).attr("class",function(a){return"actionTagItem icons "+h(a.name)+" event-"+a.actionIndex+" "+c(a.team)}).classed("hideactiontag",!0);b.append("rect").attr("class","bg").attr("x",0).attr("y",-8).attr("width",190).attr("height",15).attr("fill","white"),b.append("text").attr("class","time").attr("dx",185).attr("dy",5).text(function(a){return a.timeString}),b.append("text").attr("class","name").attr("dx",125).attr("dy",5).text(function(a){return f(a)}),b.append("text").attr("class","info").attr("dx",125).attr("dy",20).text(function(a){return g(a)}),b.filter(function(a){return"yellow"===a.category}).append("rect").attr("class","card yellowcard").attr("width",10).attr("height",15).attr("x",130).attr("y",-8).attr("rx",2).attr("ry",2),b.filter(function(a){return"red"===a.category}).append("rect").attr("class","card redcard").attr("width",10).attr("height",15).attr("x",130).attr("y",-8).attr("rx",2).attr("ry",2);var d=b.filter(function(a){return"goal"===a.category||"penalty"===a.category&&a.scoreChange}).append("g").attr("class","ball").attr("transform","translate(129,-7), scale(0.8)");d.append("circle").attr("class","goal").attr("cx",8).attr("cy",8.5).attr("r",7.5),d.append("path").attr("d",J),d.filter(function(a){return"penalty"===a.category&&a.scoreChange}).append("text").attr("class","sevenicon").attr("dx",14).attr("dy",14).text("7"),b.filter(function(a){return"suspension"===a.category}).append("path").attr("class","suspension").attr("transform",function(a){return"translate(130,-8)"}).attr("d",K)},ia=_.append("g").attr("id","scoreboard").attr("class","score").attr("transform","translate("+(t.left+(s-O)/2)+","+P+")");ia.append("rect").attr("class","background").attr("width",O+"px").attr("height",N+"px").attr("rx",U).attr("ry",U).text("0"),ia.append("rect").attr("class","frame").attr("x",V+"px").attr("y",V+"px").attr("width",O-2*V+"px").attr("height",N-2*V+"px").attr("rx",U).attr("ry",U).text("0"),ia.append("rect").attr("class","background").attr("x",2*V+"px").attr("y",2*V+"px").attr("width",O-4*V+"px").attr("height",N-4*V+"px").attr("rx",U).attr("ry",U).text("0"),ia.append("text").attr("class","team").attr("x",S+"px").attr("y",Q-32+"px").text("HEIM"),ia.append("text").attr("class","team").attr("x",T+"px").attr("y",Q-32+"px").text("GAST"),ia.append("text").attr("class","diget time bg").attr("x",O/2+"px").attr("y",R+"px").text("88 88"),ia.append("text").attr("class","diget time bg").attr("x",O/2+"px").attr("y",R+"px").text(":"),ia.append("text").attr("id","scoreTime").attr("class","diget time").attr("x",O/2+"px").attr("y",R+"px").text("0"),ia.append("text").attr("class","diget score bg").attr("x",S+"px").attr("y",Q+"px").text("88"),ia.append("text").attr("id","scoreHome").attr("class","diget score").attr("x",S+"px").attr("y",Q+"px").text("0"),ia.append("text").attr("class","diget score bg").attr("x",T+"px").attr("y",Q+"px").text("88"),ia.append("text").attr("id","scoreAway").attr("class","diget score").attr("x",T+"px").attr("y",Q+"px").text("0");var ja=_.append("g").attr("id","playerprofiles").attr("transform","translate("+X.left+","+X.top+")")});